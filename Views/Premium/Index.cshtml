@using casus_oyunu.Models
@{
    ViewData["Title"] = "Premium Özellikler";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var user = ViewBag.User as casus_oyunu.Models.User;
    var activeSubscription = ViewBag.ActiveSubscription as UserSubscription;
    var subscriptionTypes = ViewBag.SubscriptionTypes as dynamic[];
}

<div class="container-fluid px-3 px-md-4">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
            <!-- Demo Modu Uyarısı -->
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Demo Modu:</strong> Şu anda ödeme sistemi entegrasyonu yapılmadığı için abonelikler anlık olarak aktifleştirilmektedir. Gerçek ödeme sistemi eklendiğinde bu özellik güncellenecektir.
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <h1 class="text-center mb-4">
                <i class="fas fa-crown text-warning me-3"></i>
                Premium Özellikler
            </h1>
                
                @if (TempData["Success"] != null)
                {
                    <div class="alert alert-success">@TempData["Success"]</div>
                }
                @if (TempData["Error"] != null)
                {
                    <div class="alert alert-danger">@TempData["Error"]</div>
                }

                @if (activeSubscription != null)
                {
                    <div class="alert alert-info">
                        <h5>Aktif Aboneliğiniz</h5>
                        <p><strong>Tür:</strong> @activeSubscription.Type</p>
                        <p><strong>Başlangıç:</strong> @activeSubscription.StartDate?.ToLocalTime().ToString("g")</p>
                        <p><strong>Bitiş:</strong> @activeSubscription.EndDate?.ToLocalTime().ToString("g")</p>
                        <p><strong>Durum:</strong> @(activeSubscription.StartDate.HasValue && activeSubscription.EndDate.HasValue && DateTime.UtcNow >= activeSubscription.StartDate.Value && DateTime.UtcNow <= activeSubscription.EndDate.Value ? "Aktif" : "Pasif")</p>
                        
                        <form asp-action="CancelSubscription" method="post" class="mt-3">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-warning" onclick="return confirm('Aboneliğinizi iptal etmek istediğinizden emin misiniz?')">
                                Aboneliği İptal Et
                            </button>
                        </form>
                    </div>
                }
                else
                {
                    <div class="alert alert-warning">
                        <h5>Ücretsiz Hesap</h5>
                        <p>Şu anda ücretsiz hesap kullanıyorsunuz. Premium özelliklerden yararlanmak için bir abonelik seçin.</p>
                    </div>
                }

                <div class="row mt-4">
                    @if (ViewBag.SubscriptionTypes != null)
                    {
                        @foreach (var plan in ViewBag.SubscriptionTypes)
                    {
                        <div class="col-md-4 mb-4">
                            <div class="card h-100 @(activeSubscription?.Type == plan.Type ? "border-primary" : "")">
                                <div class="card-header text-center">
                                    <h5 class="card-title mb-0">@plan.Name</h5>
                                </div>
                                <div class="card-body">
                                    <div class="text-center mb-3">
                                        <h3 class="text-primary">₺@plan.Price</h3>
                                        <small class="text-muted">/ay</small>
                                    </div>
                                    <ul class="list-unstyled">
                                        @foreach (var feature in plan.Features)
                                        {
                                            <li class="mb-2">
                                                <i class="fas fa-check text-success me-2"></i>
                                                @feature
                                            </li>
                                        }
                                    </ul>
                                </div>
                                <div class="card-footer text-center">
                                    @if (activeSubscription?.Type == plan.Type)
                                    {
                                        <button class="btn btn-secondary" disabled>Aktif Abonelik</button>
                                    }
                                    else
                                    {
                                        <form asp-action="Subscribe" method="post">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="subscriptionType" value="@plan.Type" />
                                            <button type="submit" class="btn btn-primary">
                                                @(activeSubscription != null ? "Yükselt" : "Abone Ol")
                                            </button>
                                        </form>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                    }
                </div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Premium Özellikler</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-palette text-primary me-2"></i>
                                        <strong>Özel Temalar:</strong> Premium ve Pro kullanıcıları için özel temalar
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-ad text-success me-2"></i>
                                        <strong>Reklamsız Deneyim:</strong> Temel ve üzeri planlarda reklam yok
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-chart-line text-info me-2"></i>
                                        <strong>Detaylı İstatistikler:</strong> Oyun performansınızı takip edin
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-trophy text-warning me-2"></i>
                                        <strong>Turnuva Katılımı:</strong> Premium ve üzeri planlarda turnuvalara katılın
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    @if (activeSubscription != null && (activeSubscription.Type == SubscriptionType.Premium || activeSubscription.Type == SubscriptionType.Pro))
                    {
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-palette me-2"></i>Tema Seçimi</h5>
                                </div>
                                <div class="card-body">
                                    <form asp-action="UpdateTheme" method="post">
                                        @Html.AntiForgeryToken()
                                        <div class="mb-3">
                                            <label for="themeType" class="form-label">Tema Seçin</label>
                                            <select class="form-select" name="themeType" id="themeType">
                                                @{
                                                    var currentTheme = user?.UserTheme?.ThemeType ?? ThemeType.Default;
                                                }
                                                @if (currentTheme == ThemeType.Default)
                                                {
                                                    <option value="Default" selected>Varsayılan</option>
                                                }
                                                else
                                                {
                                                    <option value="Default">Varsayılan</option>
                                                }
                                                
                                                @if (currentTheme == ThemeType.Dark)
                                                {
                                                    <option value="Dark" selected>Koyu Tema</option>
                                                }
                                                else
                                                {
                                                    <option value="Dark">Koyu Tema</option>
                                                }
                                                
                                                @if (currentTheme == ThemeType.Inspector)
                                                {
                                                    <option value="Inspector" selected>Müfettiş Gadget</option>
                                                }
                                                else
                                                {
                                                    <option value="Inspector">Müfettiş Gadget</option>
                                                }
                                                
                                                @if (currentTheme == ThemeType.Matrix)
                                                {
                                                    <option value="Matrix" selected>Matrix</option>
                                                }
                                                else
                                                {
                                                    <option value="Matrix">Matrix</option>
                                                }
                                                
                                                @if (currentTheme == ThemeType.Ocean)
                                                {
                                                    <option value="Ocean" selected>Okyanus</option>
                                                }
                                                else
                                                {
                                                    <option value="Ocean">Okyanus</option>
                                                }
                                                
                                                @if (currentTheme == ThemeType.Forest)
                                                {
                                                    <option value="Forest" selected>Orman</option>
                                                }
                                                else
                                                {
                                                    <option value="Forest">Orman</option>
                                                }
                                                
                                                @if (currentTheme == ThemeType.Sunset)
                                                {
                                                    <option value="Sunset" selected>Gün Batımı</option>
                                                }
                                                else
                                                {
                                                    <option value="Sunset">Gün Batımı</option>
                                                }
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-2"></i>Temayı Uygula
                                        </button>
                                    </form>
                                    
                                    <div class="mt-3">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Tema değişikliği tüm sayfalarda geçerli olacaktır.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div> 